<!DOCTYPE html>
<html lang="ja" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Portfolio</title>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

	<!-- FullCalendar CSS -->
	<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.css" rel="stylesheet" />

	<!-- Your custom CSS -->
	<link rel="stylesheet" href="/css/style.css" th:href="@{/css/style.css}">
</head>

<body>
	<nav layout:replace="~{layouts/common :: nav}"></nav>
	<div layout:fragment="contents"></div>
	<div class="container mt-4">
		<div class="row">
			<main class="col-md-12 mx-auto">
				<!-- FullCalendarのコンテナ -->
				<h3>ガントチャート表示</h3>
				<div id="calendar"></div>
			</main>
		</div>
	</div>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

	<!-- FullCalendar core JavaScript and plugins -->
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction/main.js"></script>

	<script type="module" th:inline="javascript">
		/*<![CDATA[*/
		var events = /*[[${gantList}]]*/[];
		/*]]>*/

		document.addEventListener('DOMContentLoaded', function () {
			var calendarEl = document.getElementById('calendar');

			// FullCalendarの初期化と設定
			var calendar = new FullCalendar.Calendar(calendarEl, {
				plugins: ['dayGrid', 'timeGrid', 'interaction'],
				defaultView: 'timeGridWeek',
				header: {
					left: 'prev,next today',
					center: 'title',
					right: 'dayGridMonth,timeGridWeek,timeGridDay'
				},
				events: events,
				eventClick: function (info) {
					window.location.href = '/plans/detail/' + info.event.id;
				}
			});

			// FullCalendarのイベントデータの準備
			var eventData = events.map(function (item) {
				return {
					title: item.cropName,
					start: new Date(item.sowing_date),
					end: new Date(item.harvest_completion_date),
					id: item.id.toString(),
					className: item.completion ? 'event-completed' : 'event-planning'
				};
			});

			// カレンダーにイベントデータを追加
			calendar.addEventSource(eventData);

			// カレンダーを描画
			calendar.render();
		});
	</script>
</body>

</html>